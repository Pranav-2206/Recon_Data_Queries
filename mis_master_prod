drop table if exists payments_recon_bi_cluster.mis_master_april_prod;
create table  payments_recon_bi_cluster.mis_master_prod as 
--Truncate table payments_recon.mis_master_march ;
--insert into payments_recon.mis_master_march
(

select   txn_date ::DATE as dt, txn_id::varchar as reference_id_internal_mapping , bid::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'axis_nb' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'txn_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.axis_nb where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'axisupi_loading' as Table_name, 'Loading' as Category, response as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, '_axis_0174_7853_73303' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.axisupi_loading where dt >= '2022-03-29' union
select   txndate::DATE as dt, rrn::varchar as reference_id_internal_mapping , rrn ::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'axisupi_payout_mis__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'rrn' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.axisupi_payout_mis__v2 where dt >= '2022-03-29' union
select   date_of_txn::DATE as dt, order_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'axisupi_settlement__v2' as Table_name, 'Loading' as Category, response as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_axis_statement_0172__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.axisupi_settlement__v2 where dt >= '2022-03-29' union
select   To_date(settlement_date, 'DD/MM/YYYY')::DATE as dt, ref_1::varchar as reference_id_internal_mapping , case when To_date(settlement_date, 'DD/MM/YYYY')  = '2022-04-01' then '04-04-2022__BillDesk'
 when To_date(settlement_date, 'DD/MM/YYYY')  = '2022-04-02' then '04-04-2022__BillDesk'
else concat(to_char(c.next_working_day, 'DD-MM-YYYY'), '__BillDesk') end::varchar as reference_id_statement_mapping , gross_amount::Numeric(18,4) as gross_amount, charges::Numeric(18,4) as Commission, gst ::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'billdesk_settlement__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'ref_1' as mis_columnName_for_internal_mapping, status as Refund_Column, etl__file_name as filename, '_icici_statement__v3' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.billdesk_settlement__v2 ra INNER JOIN payments_recon.calender c ON To_date(ra.settlement_date, 'DD/MM/YYYY') = date(c.date) where dt >= '2022-03-22' union
select   settlement_date::DATE as dt, merchant_reference_id::varchar as reference_id_internal_mapping , utr_no::varchar as reference_id_statement_mapping , txn_amount::Numeric(18,4) as gross_amount, service_charge::Numeric(18,4) as Commission, st_gst::Numeric(18,4) as gst, net_settlement_amt::Numeric(18,4) as net_amount, 'cashfree_pg__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'merchant_reference_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cashfree_pg__v2 where dt >= '2022-03-29' union
select   transfer_time::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount_in_rs::Numeric(18,4) as gross_amount, service_charge_in_rs::Numeric(18,4) as Commission, service_tax_in_rs::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'cashfree_settlement__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cashfree_settlement__v2 where dt >= '2022-03-29' union
select   processedon::DATE as dt, transferid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, servicecharge::Numeric(18,4) as Commission, servicetax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'cf_imps_new_01__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transferid' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cf_imps_new_01__v2 where dt >= '2022-03-29' union
select   addedon::DATE as dt, transferid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, servicecharge::Numeric(18,4) as Commission, servicetax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'cf_imps_new_01_reversals__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transferid' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cf_imps_new_01_reversals__v2 where dt >= '2022-03-29' union
select   processed_on::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'cf_reversed_transfers__v2' as Table_name, 'Settlement' as Category, Null as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cf_reversed_transfers__v2 where dt >= '2022-03-29' union
select   case when date(settlement_date) = '2022-04-01' then '2022-04-02' else date(settlement_date) end::DATE as dt, merchant_trans_ref::varchar as reference_id_internal_mapping , NUll::varchar as reference_id_statement_mapping , nullif(txn_amount,'')::Numeric(18,4) as gross_amount, nullif(commission,'')::Numeric(18,4) as Commission, nullif((gst_),'')::Numeric(18,4) as gst, payment::Numeric(18,4) as net_amount, 'checkout_cybersource__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'merchant_trans_ref' as mis_columnName_for_internal_mapping, method as Refund_Column, etl__file_name as filename, 'axis_0174_7853_73303' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.checkout_cybersource__v2 where dt >= '2022-03-29' union
select   initiation_date::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fees::Numeric(18,4) as Commission, (cgst +
sgst +
igst)::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'cointab_reversal__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cointab_reversal__v2 where dt >= '2022-03-29' union
select   transfer_date::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fees::Numeric(18,4) as Commission, (cgst +
sgst +
igst)::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'cointab_settlement' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cointab_settlement where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'credpay_axisupi_mis' as Table_name, 'Loading' as Category, response as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, '_axis_0174_7853_73303' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.credpay_axisupi_mis where dt >= '2022-03-29' union
select   txn_date ::DATE as dt, merchant_trans_refv::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , txn_amount::Numeric(18,4) as gross_amount, commission::Numeric(18,4) as Commission, (agg_comm_amt +
gst +
agg_gst)::Numeric(18,4) as gst, payment::Numeric(18,4) as net_amount, 'cybersource_settlement__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'merchant_trans_refv' as mis_columnName_for_internal_mapping, method as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.cybersource_settlement__v2 where dt >= '2022-03-29' union
select   created_at::DATE as dt, txn_uuid::varchar as reference_id_internal_mapping , epg_txn_id::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'icici_pg__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'txn_uuid' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, '_icici_statement__v3' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.icici_pg__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'icici_upi_payout__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.icici_upi_payout__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'icici_upi_payout_02__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.icici_upi_payout_02__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, CASE
                                        WHEN SUBSTRING(txn_uuid,1,3) = 'JPY' THEN LTRIM(txn_uuid,'JPY')
                                        ELSE txn_uuid end ::varchar as reference_id_internal_mapping , banktranid::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, commission::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'icici_upi_pg__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'CASE
                                        WHEN SUBSTRING(txn_uuid,1,3) = JPY THEN LTRIM(txn_uuid,JPY)
                                        ELSE txn_uuid end ' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.icici_upi_pg__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, CASE
                                        WHEN SUBSTRING(merchanttranid,1,3) = 'JPY' THEN LTRIM(merchanttranid,'JPY')
                                        ELSE merchanttranid end ::varchar as reference_id_internal_mapping , banktranid::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, commission::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'icici_upi_pg__v3' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'CASE
                                        WHEN SUBSTRING(merchanttranid,1,3) = JPY THEN LTRIM(merchanttranid,JPY)
                                        ELSE merchanttranid end ' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_icici_upi_bulk__v3_eod_statement' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.icici_upi_pg__v3 where dt >= '2022-03-29' union
select   case when substring(etl__load_time, 1, 4) = '2022'
  then '2022-' ||substring(DATE,3,5) || '-' ||substring(DATE,1,2) else null end::DATE as dt, rrn ::varchar as reference_id_internal_mapping , to_date(concat('2022', 
        concat(
            concat('0',SUBSTRING(Split_part(Reverse(Split_part(Reverse(etl__file_name), '^', 1)),'-',1),5,1)),
            SUBSTRING(Split_part(Reverse(Split_part(Reverse(etl__file_name), '^', 1)),'-',1),6,
                         length(Reverse(Split_part(Reverse(etl__file_name), '^', 1))))
            )), 'YYYYMMDD')::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, fees::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'kotak_visadirect__v2' as Table_name, 'Settlement' as Category, Null as Status, Null as drcr_flag, 'rrn ' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.kotak_visadirect__v2 where dt >= '2022-03-29' union
select   hermes_transaction_date::DATE as dt, plutus_order_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , total_amount_paid::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'ksf_cred_mis__v2' as Table_name, 'cred mis' as Category, Null as Status, Null as drcr_flag, 'plutus_order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.ksf_cred_mis__v2  union
select   loan_start_date::DATE as dt, loan_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , disbursal_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'ksf_disbursal_mis__v2' as Table_name, 'disbursal' as Category, Null as Status, Null as drcr_flag, 'loan_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.ksf_disbursal_mis__v2  union
select   settlement_date::DATE as dt, order_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , plutus_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'liquiloans_cred_mis__v2' as Table_name, 'disbursal' as Category, Null as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.liquiloans_cred_mis__v2  union
select   date::DATE as dt, transaction_id::varchar as reference_id_internal_mapping , SPLIT_PART (transaction_id,'-',2)::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, payment_processing_fee::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'mint_payu__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'SPLIT_PART (transaction_id,-,2)' as mis_columnName_for_internal_mapping, requested_action as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.mint_payu__v2 where dt >= '2022-03-29' union
select   txn_date::DATE as dt, tp_order_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , paid_amount::Numeric(18,4) as gross_amount, commisison::Numeric(18,4) as Commission, commisison_gst::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'payu_bbps' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'tp_order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.payu_bbps where dt >= '2022-03-29' union
select   date::DATE as dt, transaction_id::varchar as reference_id_internal_mapping , merchant_utr::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, payment_processing_fee::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'payu_bbps_loading__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'transaction_id' as mis_columnName_for_internal_mapping, requested_action as Refund_Column, etl__file_name as filename, '_scb_statement_351' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.payu_bbps_loading__v2 where dt >= '2022-03-29' union
select   rs_date::DATE as dt, transaction_id::varchar as reference_id_internal_mapping , merchant_utr::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, payment_processing_fee::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'payu_settlement__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'transaction_id' as mis_columnName_for_internal_mapping, requested_action as Refund_Column, etl__file_name as filename, '_icici_statement__v3' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.payu_settlement__v2 where dt >= '2022-03-29' union
select   created_at::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fees_tax_inclusive::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'razorpay_payout__v2' as Table_name, 'Settlement' as Category,  CASE
                                         WHEN LOWER(status) = 'processed' THEN 'completed'
                                         ELSE 'failed'
                                       END as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.razorpay_payout__v2 where dt >= '2022-03-29' union
select   entity_created_at::DATE as dt, case when transaction_id = '' then order_id else transaction_id end::varchar as reference_id_internal_mapping , settlement_utr::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fee_excl_tax::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'razorpay_settlement__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'transaction_id, if null then order_id' as mis_columnName_for_internal_mapping, transaction_entity as Refund_Column, etl__file_name as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.razorpay_settlement__v2 where dt >= '2022-03-29' union
--select   datetime_processed::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rbl_mastersend_payout__v2' as Table_name, 'Settlement' as Category, CASE When lower(response_code) = '0' Then 'success' When lower(response_code) = '00' Then 'success' Else 'Failed' End as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rbl_mastersend_payout__v2 where dt >= '2022-03-29' union
select   update_time::DATE as dt, ref_2::varchar as reference_id_internal_mapping , CASE
 WHEN utrno = '' THEN LPAD(rrn,12,0)
ELSE utrno end::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rbl_mis_failure__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'ref_2' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rbl_mis_failure__v2 where dt >= '2022-03-29' union
select   update_time::DATE as dt, ref_2::varchar as reference_id_internal_mapping , CASE
 WHEN utrno = '' THEN LPAD(rrn,12,0)
ELSE utrno end::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rbl_mis_success__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'ref_2' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rbl_mis_success__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, utr::varchar as reference_id_internal_mapping , dateadd(DAY,-1,to_Date(concat('2022',
                                        concat(
                                            concat('0',substring(Split_part(Reverse(Split_part(reverse(etl__file_name), '^', 1)),'-',1),5,1)),                       
                                            substring(Split_part(Reverse(Split_part(reverse(etl__file_name), '^', 1)),'-',1),6,
                                                     length(Split_part(Reverse(Split_part(reverse(etl__file_name), '^', 1)),'-',1))
                                                    )
                                             )
                
                        ),'YYYYMMDD'))::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, fees ::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rbl_visa_payout__v4' as Table_name, 'Settlement' as Category, Null as Status, Null as drcr_flag, 'utr' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rbl_visa_payout__v4 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, txn_ref_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , transactions_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rblbank_mis_0001__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'txn_ref_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rblbank_mis_0001__v2 where dt >= '2022-03-29' union
select   txn_date::DATE as dt, orderid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, surcharge::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, debit_amount::Numeric(18,4) as net_amount, 'rent_axisupi__v2' as Table_name, 'Loading' as Category, response as Status, Null as drcr_flag, 'orderid' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_axis_0174_7853_73303' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_axisupi__v2 ra INNER JOIN payments_recon.calender c ON date(ra.txn_date) = date(c.date) where dt >= '2022-03-29' union
select   settlement_date::DATE as dt, merchant_trans_ref::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , txn_amount::Numeric(18,4) as gross_amount, commission::Numeric(18,4) as Commission, (agg_comm_amt +
gst +
agg_gst )::Numeric(18,4) as gst, payment::Numeric(18,4) as net_amount, 'rent_cybersource__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'merchant_trans_ref' as mis_columnName_for_internal_mapping, method as Refund_Column, etl__file_name as filename, '_axis_statement__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_cybersource__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, merchanttranid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, commission::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rent_iciciupi__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'merchanttranid' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_iciciupi__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, merchanttranid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, commission::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rent_iciciupi__v3' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'merchanttranid' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_icici_statement__v3' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_iciciupi__v3 where dt >= '2022-03-29' union
select   added_on::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, service_charge::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rent_lending_cashfree_payout__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_lending_cashfree_payout__v2 where dt >= '2022-03-29' union
select   processed_on::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rent_lending_cashfree_reversed_transfers__v2' as Table_name, 'Settlement' as Category, Null as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_lending_cashfree_reversed_transfers__v2 where dt >= '2022-03-29' union
select   initiation_date 
::DATE as dt, transaction_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , paid_amount::Numeric(18,4) as gross_amount, fees::Numeric(18,4) as Commission, (cgst + 
sgst +
igst )::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'rent_lending_cointab_payout__v2' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transaction_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_lending_cointab_payout__v2 where dt >= '2022-03-29' union
select   date::DATE as dt, transaction_id::varchar as reference_id_internal_mapping , merchant_utr::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, payment_processing_fee::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'rent_payu__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'transaction_id' as mis_columnName_for_internal_mapping, requested_action as Refund_Column, etl__file_name as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_payu__v2 where dt >= '2022-03-29' union
select   settlement_date::DATE as dt, txn_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , case when mdr_msf = 0.0000 
then total_amount_paid_to_me 
else gross_txn_amount end::Numeric(18,4) as gross_amount, total_fee_excl_tax::Numeric(18,4) as Commission, gst_on_total_fee::Numeric(18,4) as gst, total_amount_paid_to_me::Numeric(18,4) as net_amount, 'pinelabs_loading__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'txn_id' as mis_columnName_for_internal_mapping, case when mdr_msf = '0.0000' then 'Refund' else 'Not_Refund' end as Refund_Column, etl__file_name as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.pinelabs_loading__v2 where dt >= '2022-03-29' union
--select   entity_created_at::DATE as dt, JSON_EXTRACT_PATH_TEXT (payment_notes,'transaction_id',TRUE)::varchar as reference_id_internal_mapping , settlement_utr::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fee_exclusive_tax::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rent_razorpay__v2' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'JSON_EXTRACT_PATH_TEXT (payment_notes,transaction_id,TRUE)' as mis_columnName_for_internal_mapping, transaction_entity as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_razorpay__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, txn_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , total_amount::Numeric(18,4) as gross_amount, charges::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'rent_stash_tpsl_pg__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'txn_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_stash_tpsl_pg__v2 ra INNER JOIN payments_recon.calender c ON date(ra.transaction_date) = date(c.date) where dt >= '2022-03-29' union
select   settlement_date::DATE as dt, merchant_reference_id::varchar as reference_id_internal_mapping , utr::varchar as reference_id_statement_mapping , transaction_amount::Numeric as gross_amount, transaction_service_charge::Numeric as Commission, txn_st_gst::Numeric as gst, net_settlement_amount::Numeric as net_amount, 'rent_store_stash_cashfreepg_loading' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'merchant_reference_id' as mis_columnName_for_internal_mapping, event_type as Refund_Column, Null as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_store_stash_cashfreepg_loading where dt >= '2022-03-29' union
select   value_date::DATE as dt, merchant_track_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , case when transaction_type = 'TERM' then transaction_amount when transaction_type = 'TERM_FULL_CAN_REV' then (-1)*transaction_amount else Null end ::Numeric(18,4) as gross_amount, mdr::Numeric(18,4) as Commission, (igst + cgst + sgst)::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'stash_idfc_mis__v2' as Table_name, 'disbursal' as Category, Null as Status, case when transaction_type = 'TERM' then 'Credit'
when transaction_type = 'TERM_FULL_CAN_REV' then 'Debit' end as drcr_flag, 'merchant_track_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.stash_idfc_mis__v2 union
select   disbursed_date::DATE as dt, SPLIT_PART (utr,'|',1)::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , product_amt::Numeric(18,4) as gross_amount, processing_fees_amt::Numeric(18,4) as Commission, gst_amt::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'stash_liquiloans__v2' as Table_name, 'cred mis' as Category, Null as Status, Null as drcr_flag, 'SPLIT_PART (utr,|,1)' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.stash_liquiloans__v2  union
select   transaction_date::DATE as dt, txn_id::varchar as reference_id_internal_mapping ,Null::varchar as reference_id_statement_mapping , total_amount::Numeric(18,4) as gross_amount, charges::Numeric(18,4) as Commission, service_tax::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'tpsl_pg__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'txn_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.tpsl_pg__v2 ra INNER JOIN payments_recon.calender c ON date(ra.transaction_date) = date(c.date) where dt >= '2022-03-29' union 
select   created_at::DATE as dt, external_transaction_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mastersend__v2' as Table_name, 'Settlement' as Category, CASE
                                               WHEN LOWER(txn_status) = '4' THEN 'completed'
                                               ELSE 'failed'
                                             END  as Status, Null as drcr_flag, 'external_transaction_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mastersend__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , customer_ref_no::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, msf_amount::Numeric(18,4) as Commission, msf_tax_amount::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mis_0802' as Table_name, 'Loading' as Category, transaction_status as Status, dr_cr as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping,  case when dr_cr = 'Debit' then 'Refund' else dr_cr end as Refund_Column, Null as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mis_0802 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , customer_ref_no ::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, msf_amount::Numeric(18,4) as Commission, msf_tax_amount::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mis_6148__v2' as Table_name, 'Loading' as Category, transaction_status as Status, drcr_flag as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping, case when drcr_flag = 'Debit' then 'Refund' else drcr_flag end as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mis_6148__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , customer_ref_no ::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, msf_amount::Numeric(18,4) as Commission, msf_tax_amount::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mis_6201__v2' as Table_name, 'Settlement' as Category, transaction_status as Status, drcr as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping, case when drcr = 'Debit' then 'Refund' else drcr end as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mis_6201__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, msf_amount::Numeric(18,4) as Commission, msf_tax_amount::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mis_9460__v2' as Table_name, 'Settlement' as Category, transaction_status as Status, drcr_flag as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping, case when drcr_flag = 'Debit' then 'Refund' else drcr_flag end as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mis_9460__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , customer_ref_no::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, msf_amount::Numeric(18,4) as Commission, msf_tax_amount::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mis_9470__v2' as Table_name, case when drcr_flag = 'C' and transaction_amount < 0 then 'Settlement' else 'Loading' end  as Category, transaction_status as Status, drcr_flag as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping, case when drcr_flag = 'Debit' then 'Refund' else drcr_flag end as Refund_Column, etl__file_name as filename, '_yesbank_statement_9470__v3' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mis_9470__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, msf_amount::Numeric(18,4) as Commission, msf_tax_amount::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_mis_9480__v2' as Table_name, 'Settlement' as Category, Null as Status, drcr_flag as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping, case when drcr_flag = 'Debit' then 'Refund' else drcr_flag end as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_mis_9480__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_no::varchar as reference_id_internal_mapping , customer_ref_no::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, nullif(msf_amount,'')::Numeric(18,4) as Commission, nullif(msf_tax_amount,'')::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_upi__v2' as Table_name, 'Loading' as Category, transaction_status as Status, drcr as drcr_flag, 'order_no' as mis_columnName_for_internal_mapping, case when drcr = 'Debit' then 'Refund' else drcr end  as Refund_Column, etl__file_name as filename, '_yesbank_statement_v2_0802_bulk' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_upi__v2 where dt >= '2022-03-29' union
select   created_at::DATE as dt, external_transaction_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_visadirect__v2' as Table_name, 'Settlement' as Category, CASE
                                               WHEN LOWER(txn_status) = '4' THEN 'completed'
                                               ELSE 'failed'
                                             END as Status, Null as drcr_flag, 'external_transaction_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_visadirect__v2 where dt >= '2022-03-29' union
select   created_at::DATE as dt, external_transaction_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'yesbank_visadirect__v3' as Table_name, 'Settlement' as Category, CASE
                                               WHEN LOWER(txn_status) = '4' THEN 'completed'
                                               ELSE 'failed'
                                             END  as Status, Null as drcr_flag, 'external_transaction_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.yesbank_visadirect__v3 where dt >= '2022-03-29' union
select   created_at::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, (fees_tax_inclusive-tax)::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'razorpay_payout__v3' as Table_name, 'Settlement' as Category,  CASE
                                         WHEN LOWER(status) = 'processed' THEN 'completed'
                                         ELSE 'failed'
                                       END as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.razorpay_payout__v3 where dt >= '2022-03-29' union
select   date::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'icici_upi_payout__v3' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'transfer_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.icici_upi_payout__v3 where dt >= '2022-03-29' union
select   entity_created_at::DATE as dt, case when transaction_id = '' then order_id else transaction_id end::varchar as reference_id_internal_mapping , case when settled_by = 'hdfc' then null else settlement_utr end::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fee_excl_tax::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'razorpay_settlement__v3' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'transaction_id, if null then order_id' as mis_columnName_for_internal_mapping, transaction_entity as Refund_Column, etl__file_name as filename, case when Split_part(etl__file_name, '_', 1) = 'ERCW249IGBBbQh' then '_icici_statement__v3' 
when Split_part(etl__file_name, '_', 1) = 'BRdWZlPhTARtJw' then '_hdfc_statement_8533__v2' when Split_part(etl__file_name, '_', 1) = 'Agy3USzi0hvOur' then '_hdfc_statement_8533__v2' else '_hdfc_statement_8533__v2' end as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.razorpay_settlement__v3 where dt >= '2022-03-29' union
select   entity_created_at::DATE as dt, JSON_EXTRACT_PATH_TEXT (payment_notes,'transaction_id',TRUE)::varchar as reference_id_internal_mapping , case when settled_by ='hdfc' then null else settlement_utr end ::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fee_exclusive_tax::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rent_razorpay__v3' as Table_name, 'Loading' as Category, status as Status, Null as drcr_flag, 'JSON_EXTRACT_PATH_TEXT (payment_notes,transaction_id,TRUE)' as mis_columnName_for_internal_mapping, transaction_entity as Refund_Column, etl__file_name as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rent_razorpay__v3 where dt >= '2022-03-29' union
select   cutoff_date::DATE as dt, transfer_id::varchar as reference_id_internal_mapping , dateadd(DAY,1,cutoff_date)::varchar as reference_id_statement_mapping , transaction_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'rbl_mastersend_payout__v4' as Table_name, 'Settlement' as Category, CASE  When  lower(response_code) = '0' Then 'success' 
            When lower(response_code) = '00' Then 'success'
Else 'Failed' End as Status, Null as drcr_flag, 'retrieval_reference' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.rbl_mastersend_payout__v4 where dt >= '2022-03-31' union
select   settlement_date::DATE as dt, merchant_trans_ref::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , txn_amount::Numeric(18,4) as gross_amount, commission ::Numeric(18,4) as Commission, (agg_comm_amt + gst 
+ agg_gst)::Numeric(18,4) as gst, payment::Numeric(18,4) as net_amount, 'bbps_cybersource__v2' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'merchant_trans_ref' as mis_columnName_for_internal_mapping, method as Refund_Column, etl__file_name as filename, '_axis_statement__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.bbps_cybersource__v2 where dt >= '2022-03-29' union
select   created_at::DATE as dt, JSON_EXTRACT_PATH_TEXT(payments_notes,'transaction_id',TRUE)::varchar as reference_id_internal_mapping , case when settled_by = 'hdfc' then null else settlements_utr end::varchar as reference_id_statement_mapping , base_amount_rs::Numeric(18,4) as gross_amount, fee_exclusive_tax::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'bbps_razorpay' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'payments_notes' as mis_columnName_for_internal_mapping, transactions_entity as Refund_Column, Null as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.bbps_razorpay where dt >= '2022-03-29' union
select   updated_at::DATE as dt, txn_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'mint_axis_cred_mis__v2' as Table_name, 'Loading' as Category, payment_status as Status, Null as drcr_flag, 'gateway_reference_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.mint_axis_cred_mis__v2 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, request_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'mint_liquiloans__v3' as Table_name, 'Settlement' as Category, Null as Status, Null as drcr_flag, 'request_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.mint_liquiloans__v3 where dt >= '2022-03-29' union
select   entity_created_at::DATE as dt, JSON_EXTRACT_PATH_TEXT(payment_notes,'transaction_id')::varchar as reference_id_internal_mapping , case when settled_by = 'hdfc' then null else settlement_utr end ::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, fee_exclusive_tax::Numeric(18,4) as Commission, tax::Numeric(18,4) as gst, credit::Numeric(18,4) as net_amount, 'mint_razorpay' as Table_name, 'Loading' as Category, Null as Status, Null as drcr_flag, 'SON_EXTRACT_PATH_TEXT (payment_notes,transaction_id)' as mis_columnName_for_internal_mapping, transaction_entity as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.mint_razorpay where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, reference_number::varchar as reference_id_internal_mapping , date(Split_part(Reverse(Split_part(Reverse(etl__file_name), '^', 1)),'.',1) )::varchar as reference_id_statement_mapping , completed_amt_settlement::Numeric(18,4) as gross_amount, interchange_fee::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'kotak_mastersend_payout' as Table_name, 'Settlement' as Category, CASE When lower(message_type_indicator) = 'frec' Then 'success'
 Else 'Failed' End as Status, completed_amount_settlement_dr_cr_indicator as drcr_flag, 'reference_number' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.kotak_mastersend_payout__v2 where dt >= '2022-03-31' union
select   payment_date::DATE as dt, tp_order_id::varchar as reference_id_internal_mapping , settlement_utr::varchar as reference_id_statement_mapping , paid_amount::Numeric(18,4) as gross_amount, commisison::Numeric(18,4) as Commission, gst::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'payu_bbps_cred_mis' as Table_name, 'Settlement' as Category, status as Status, Null as drcr_flag, 'tp_order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.payu_bbps_cred_mis where dt >= '2022-03-29' union
select   trans_date::DATE as dt, merchant_trackid::varchar as reference_id_internal_mapping , concat(concat(to_char(settle_date, 'DD-MM-YYYY'), '__'), terminal_number)::varchar as reference_id_statement_mapping , domestic_amt::Numeric(18,4) as gross_amount, (msf + serv_tax + sb_cess +
kk_cess)::Numeric(18,4) as Commission, (cgst_amt + sgst_amt +
igst_amt + utgst_amt) ::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'hdfc_pg_bbps' as Table_name, 'Loading' as Category, Null  as Status, debitcredit_type as drcr_flag, 'udf1' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.hdfc_pg_bbps where dt >= '2022-03-29' union
select   trans_date::DATE as dt, merchant_trackid::varchar as reference_id_internal_mapping , concat(concat(to_char(settle_date, 'DD-MM-YYYY'), '__'), terminal_number)::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, (msf + serv_tax + sb_cess +
kk_cess)::Numeric(18,4) as Commission, (cgst_amt + sgst_amt +
igst_amt + utgst_amt) ::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'hdfc_pg_ccbp' as Table_name, 'Loading' as Category, Null  as Status, debitcredit_type as drcr_flag, 'udf1' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.hdfc_pg_ccbp where dt >= '2022-03-29' union
select   trans_date::DATE as dt, merchant_trackid::varchar as reference_id_internal_mapping , concat(concat(to_char(settle_date, 'DD-MM-YYYY'), '__'), terminal_number)::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, (msf + serv_tax + sb_cess +
kk_cess)::Numeric(18,4) as Commission, (cgst_amt + sgst_amt +
igst_amt + utgst_amt) ::Numeric(18,4) as gst, net_amount::Numeric(18,4) as net_amount, 'hdfc_pg_rent_temp' as Table_name, 'Loading' as Category, Null  as Status, debitcredit_type as drcr_flag, 'udf1' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, '_hdfc_statement_8533__v2' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.hdfc_pg_rent_temp where dt >= '2022-03-29' union
select   txn_ref_date::DATE as dt, order_id::varchar as reference_id_internal_mapping , case when etl__file_name like ('%CRED CLUB REFUND%') and date(txn_ref_date) is not null then concat(left(right(replace(etl__file_name,'.',''),11),8),'__refunds_axisupi') else null end ::varchar as reference_id_statement_mapping , refund_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'refunds_axisupi__v3' as Table_name, 'Refund' as Category, response as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, 'Refund' as Refund_Column, etl__file_name as filename, '_axis_0174_7853_73303' as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.refunds_axisupi__v3 where dt >= '2022-03-29' union
select   txn_ref_date::DATE as dt, order_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , refund_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'refunds_axisupi_01__v3' as Table_name, 'Refund' as Category, response as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, 'Refund' as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.refunds_axisupi_01__v3 where dt >= '2022-03-29' union
select   transaction_date::DATE as dt, order_id::varchar as reference_id_internal_mapping , rrn::varchar as reference_id_statement_mapping , amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'max_store_mint_axisupi_loading' as Table_name, 'Loading' as Category, response as Status, Null as drcr_flag, 'order_id' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.max_store_mint_axisupi_loading where dt >= '2022-03-29' union
select   refund_txn_date::DATE as dt, merchanttranid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , refund_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'refunds_iciciupi__v3' as Table_name, 'Refund' as Category, status as Status, Null as drcr_flag, 'merchanttranid' as mis_columnName_for_internal_mapping, 'Refund' as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.refunds_iciciupi__v3 where dt >= '2022-03-29' union
select   date_of_refund_req::DATE as dt, substring(merchant_txn_id,3,length(merchant_txn_id)-3)::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , total_amount::Numeric(18,4) as gross_amount, Null::Numeric(18,4) as Commission, Null::Numeric(18,4) as gst, Null::Numeric(18,4) as net_amount, 'tpsl_pg_refund__v3' as Table_name, 'Refund' as Category, Null as Status, Null as drcr_flag, 'substring(merchant_txn_id,3,length(merchant_txn_id)-3)' as mis_columnName_for_internal_mapping, 'Refund' as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.tpsl_pg_refund__v3 where dt >= '2022-03-29' union
select   loan_start_date::DATE as dt, loan_id::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , (-1)*disbursal_amount::Numeric as gross_amount, Null::Numeric as Commission, Null::Numeric as gst, Null::Numeric as net_amount, 'ksf_cancellation_mis__v2' as Table_name, 'cancellation' as Category, Null as Status, 'debit' as drcr_flag, '' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.ksf_cancellation_mis__v2 union
select   settlement_date::DATE as dt, Null::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , (-1)*amount::Numeric as gross_amount, Null::Numeric as Commission, Null::Numeric as gst, Null::Numeric as net_amount, 'liquiloans_cancellation_mis' as Table_name, 'cancellation' as Category, Null as Status, 'debit' as drcr_flag, '' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.liquiloans_cancellation_mis  union
select   reimbursed_date::DATE as dt, Null::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , investor_disbursement_amount::Numeric as gross_amount, Null::Numeric as Commission, Null::Numeric as gst, Null::Numeric as net_amount, 'vivriti_disbursal_mis' as Table_name, 'disbursal' as Category, Null as Status, 'credit' as drcr_flag, '' as mis_columnName_for_internal_mapping, Null as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link, concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.vivriti_disbursal_mis union
select   settled_on::DATE as dt, bank_request_id::varchar as reference_id_internal_mapping , utr::varchar as reference_id_statement_mapping , (-1)*plutus_amount::Numeric as gross_amount, Null::Numeric as Commission, Null::Numeric as gst, Null::Numeric as net_amount, 'idfc_cred_mis__v2' as Table_name, 'repayment' as Category, Null as Status, 'debit' as drcr_flag, '' as mis_columnName_for_internal_mapping, Null as Refund_Column, etl__file_name as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link , concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.idfc_cred_mis__v2 union
select   refund_date::DATE as dt, orderid::varchar as reference_id_internal_mapping , Null::varchar as reference_id_statement_mapping , refund_amount::Numeric as gross_amount, Null::Numeric as Commission, Null::Numeric as gst, Null::Numeric as net_amount, 'chargeback_axis' as Table_name, 'Chargeback' as Category, Null as Status, Null as drcr_flag, 'orderid' as mis_columnName_for_internal_mapping, 'Chargeback' as Refund_Column, Null as filename, Null as sourced, concat(reference_id_statement_mapping,sourced) as link,concat(concat(autoid,'_'), Table_name) as Unique_id, 'Rs'::varchar(32) as currency, Null::varchar(512) as exception_remarks from payments_recon.chargeback_axis)
